@model OMS.Data.Domain.Order
@{
    ViewData["Title"] = "B2B退单详情";
    Layout = "~/Views/Shared/_NormalLayout.cshtml";
}
@section Styles{
    <link href="~/Style/loading.css" rel="stylesheet" />
}
<div class="row">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bubble font-green"></i>
                    <span class="caption-subject font-green bold uppercase">B2B退单详情</span>
                </div>
                <div class="x-nav">
                    <a class="btn btn-primary btn-circle btn-sm" style="float:right" href="javascript:;" onClick="javascript:window.location.reload();" title="刷新">
                        <i class="layui-icon">&#xe9aa;</i>
                    </a>
                </div>
            </div>
            <div class="portlet-body">
                <table id="mainTable" class="table table-bordered table-hover">
                    <tbody>
                        <tr>
                            <td colspan="4" style="text-align:center"><strong>基本信息</strong><input type="text" id="orderId" name="orderId" value="@Model.Id" hidden /></td>
                        </tr>
                        <tr>
                            <td style="width:15%"><strong>订单号</strong></td>
                            <td style="width:30%"><input type="text" name="name" class="form-control" value="@Model.SerialNumber" readonly /></td>
                            <td style="width:15%"><strong>原订单号</strong></td>
                            <td style="width:30%"><input type="text" name="name" class="form-control" value="@Model.OrgionSerialNumber" readonly /></td>
                        </tr>
                        <tr>
                            <td><strong>订单日期</strong></td>
                            <td>@Model.CreatedTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                            <td><strong>订单状态</strong></td>
                            <td><span id="OrderStateStr" class="label label-danger  circle">@ViewBag.OrderStateStr[Model.State]</span><span id="orderState" hidden>@Model.State</span></td>
                        </tr>
                        <tr>
                            <td><strong>客户</strong></td>
                            <td>@Html.DropDownList("CustomerId", ViewBag.Customers as SelectList, "请选择", new { @class = "form-control" })</td>
                            <td><strong>价格类型</strong></td>
                            <td>@Html.DropDownList("PriceTypeId", ViewBag.PriceTypeStr as SelectList, "请选择", new { @class = "form-control", @disabled = false })</td>
                        </tr>
                        <tr>
                            <td><strong>客户联系人</strong></td>
                            <td><input type="text" class="form-control" name="customerName" value="@Model.CustomerName" /></td>
                            <td><strong>客户联系电话</strong></td>
                            <td><input type="text" name="customerPhone" class="form-control" value="@Model.CustomerPhone" /></td>
                        </tr>
                        <tr>
                            <td><strong>省市区</strong></td>
                            <td>
                                <div class="vgroup">
                                    <span name="FullAddress" hidden>@Model.AddressDetail</span>
                                    <input id="ssq" type="text" name="District" value="" hidden />
                                    <div id="Shengshiqu" data-toggle="distpicker" class="btn-group">
                                        <select class="btn btn-default"></select>
                                        <select class="btn btn-default"></select>
                                        <select class="btn btn-default vinput"></select>
                                    </div>
                                </div>
                            </td>
                            <td><strong>详细地址</strong></td>
                            <td><input type="text" id="XXAddress" name="XXAddress" class="form-control" /></td>
                        </tr>
                        <tr>
                            <td><strong>退货仓库</strong></td>
                            <td>@Html.DropDownList("WareHouseId", ViewBag.WareHouse as SelectList, "请选择", new { @class = "form-control" })</td>
                            <td><strong>业务员</strong></td>
                            <td>@Html.DropDownList("SalesMans", ViewBag.SalesMans as SelectList, "请选择", new { @class = "form-control" })</td>

                        </tr>
                        <tr>
                            <td><strong>总金额</strong></td>
                            <td>@Model.SumPrice</td>
                            <td><strong>已退金额</strong></td>
                            <td>@Model.PayPrice</td>
                        </tr>
                        <tr>
                            <td><strong>客户留言</strong></td>
                            <td><textarea class="form-control" id="customerMark">@Model.CustomerMark</textarea></td>
                            <td><strong>管理员留言</strong></td>
                            <td><textarea class="form-control" id="adminMark">@Model.AdminMark</textarea></td>
                        </tr>
                        <tr>
                            <td><strong>给仓库留言</strong></td>
                            <td><textarea class="form-control" id="toWareHouseMessage">@Model.ToWarehouseMessage</textarea></td>
                            <td><strong>财务备注</strong></td>
                            <td><div class="col-md-9"><textarea class="form-control" id="financeMark">@Model.FinanceMark</textarea></div><div  class="col-md-3"><input type="button" class="btn btn-primary" id="updateFinanceMark" name="name" value="保存财务备注" /></div></td>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-bordered table-hover" id="OrderProductsTB">
                    <thead>
                        <tr>
                            <td colspan="8" style="text-align:center">
                                <strong>订单商品</strong>&nbsp;
                                <button class="btn btn-default" id="AddRefundProductBtn" type="button" name="AddRefundProducts" data-toggle="modal" data-target="#AddRefundProducts">添加商品</button>
                            </td>
                        </tr>
                        <tr>
                            <th>商品名</th>
                            <th>编码</th>
                            <th>数量</th>
                            <th>商品价格</th>
                            <th>销售单价</th>
                            <th>销售总价</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in ViewBag.OrderProducts)
                        {
                            <tr>
                                <td name="tProductName" style="text-align:left">@item.SaleProduct.Product.Name</td>
                                <td class="text-left" name="tProductCode">@item.SaleProduct.Product.Code</td>
                                <td name="tQuantity" data-quantity="@item.Quantity" style="text-align:left">@item.Quantity</td>
                                <td name="tOrginPrice" style="text-align:left">@item.OrginPrice</td>
                                <td name="tPrice" style="text-align:left">@item.Price</td>
                                <td name="tSumPrice" style="text-align:left">@item.SumPrice</td>
                                <td style="text-align:left">
                                    <input class="btn btn-default btn-sm" type="button" name="delSaleProduct" value="删除" data-id="@item.Id" />
                                    <input class="btn btn-default btn-sm" type="button" name="updateSaleProduct" value="修改" data-id="@item.Id" data-toggle="modal" data-target="#ChangeProductPrice" />
                                </td>

                            </tr>
                        }
                    </tbody>
                </table>

                <div class="row">
                    <div class="col-md-12 text-right">
                        <input type="button" class="btn btn-default red" id="saveB2BOrder" name="saveB2BOrder" value="&nbsp;保&nbsp;存&nbsp;" />
                        <input type="button" class="btn btn-default red" id="confirmOrder" name="confirmOrder" value="&nbsp;确&nbsp;认&nbsp;" />
                        <input type="button" class="btn btn-default yellow" id="unConfirmOrder" name="unConfirmOrder" value="反&nbsp;确&nbsp;认&nbsp;" />
                        <input type="button" class="btn btn-default red" id="upLoadOrder" name="upLoadOrder" value="上传订单" />
                        <input type="button" class="btn btn-default yellow" id="cancelUploadOrder" name="cancelUploadOrder" value="取消上传" />
                        <input type="button" class="btn btn-default green" id="checkAcceptOrder" name="checkAcceptOrder" value="验收" />
                        <input type="button" class="btn btn-default blue" id="Bookkeeping" name="Bookkeeping" value="记账" />
                        <input type="button" class="btn btn-default red" id="SetInvalid" name="SetInvalid" value="设为无效" />
                        <input type="button" class="btn btn-default" onclick="showOpLog(@Model.Id)" name="name" value="操作日志" />
                        @*<input type="button" class="btn btn-default yellow" id="updateFinanceMark" name="name" value="保存财务备注" />*@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--modal BEGIN-->
<!--操作日志-->
<div id="orderOpLog" class="modal fade">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">操作日志</h4>
            </div>
            <div class="modal-body">
                <div class="dataTable">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>操作人</th>
                                <th>操作名称</th>
                                <th>操作时间</th>
                                <th>订单状态</th>
                                <th>备注</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 模态框（Modal）商品选择 -->
<div class="modal fade" id="productsModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" style="width:1000px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">商品选择</h4>
            </div>
            <div class="modal-body" style="display:inline-block">
                <div class="col-md-6 col-sm-6" style="margin-bottom:10px;">
                    <div>
                        <label>
                            <input id="searchKey" class="form-control input-sm input-small input-inline" placeholder="Search">
                        </label>
                        <button type="button" onclick="showProducts()" class="btn green-haze btn-outline btn-circle btn-sm" style="margin-left:15px;">
                            搜&nbsp;索
                        </button>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="portlet-body">
                        <table class="table table-striped table-hover table-bordered">
                            <thead>
                                <tr>
                                    <th style="width:20%"> 商品编号 </th>
                                    <th style="width:35%"> 中文名 </th>
                                    <th style="width:35%"> 英文名 </th>
                                    <th style="width:10%"> 操作 </th>
                                </tr>
                            </thead>
                            <tbody id="tbody"></tbody>
                        </table>
                        <ul id="pageLimit" style="float:right"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal -->
<div id="stack2" class="modal fade" tabindex="-1">
    <div class="modal-dialog" style="width:800px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">商品信息</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="tab-pane">
                        <div class="portlet box" style="border-bottom: 1px solid #5cd1db;">
                            <div class="portlet-body form">
                                <!-- BEGIN FORM-->
                                <form action="#" class="form-horizontal">
                                    <div class="form-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="form-group">
                                                    <label class="control-label col-md-2">商品名称</label>
                                                    <div class="col-md-10">
                                                        <input type="text" id="order_product_id" value="" hidden />
                                                        <p class="form-control-static" id="pName"></p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">商品编号</label>
                                                    <div class="col-md-8">
                                                        <p class="form-control-static" id="code"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4" id="priceName">标准价</label>
                                                    <div class="col-md-8">
                                                        <input type="number" id="order_product_orginPrice" readonly class="form-control" value="">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">折扣</label>
                                                    <div class="col-md-8">
                                                        <input type="number" class="form-control" id="discount" min="0.01" max="1.00" step="0.1" value="1.00">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">单价</label>
                                                    <div class="col-md-8">
                                                        <input type="text" id="order_product_price" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">数量</label>
                                                    <div class="col-md-8">
                                                        <input type="number" id="order_product_quantity" class="form-control" min="1">
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">总金额</label>
                                                    <div class="col-md-8">
                                                        <input type="text" id="order_product_sumprice" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <h5 class="form-section">库存信息</h5>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">库存</label>
                                                    <div class="col-md-8">
                                                        <p class="form-control-static" id="stock">0</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">锁定库存</label>
                                                    <div class="col-md-8">
                                                        <p class="form-control-static" id="lockStock">0</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">可售库存</label>
                                                    <div class="col-md-8">
                                                        <p class="form-control-static" id="availableStock">0</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <!-- END FORM-->
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn dark btn-outline">取消</button>
                <button type="button" class="btn green" id="order_product_ok" onclick="addOrderProduct()">确认</button>
            </div>
        </div>
    </div>
</div>


<!-- 模态框（Modal）记账 -->
<div class="modal fade" id="BookkeepingModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <div class="modal-title">记账信息</div>
            </div>
            <div class="modal-body">
                <div class="row form-group">
                    <label class="col-md-3 control-label text-align-reverse">类型</label>
                    <div class="col-md-9 md-radio-inline">
                        <div class="md-radio">
                            <input type="radio" id="radio1" name="radio1" class="md-radiobtn" checked value="1">
                            <label for="radio1">
                                <span></span>
                                <span class="check"></span>
                                <span class="box"></span> 汇款
                            </label>
                        </div>
                        <div class="md-radio">
                            <input type="radio" id="radio2" name="radio1" class="md-radiobtn" value="2">
                            <label for="radio2">
                                <span></span>
                                <span class="check"></span>
                                <span class="box"></span> 退款
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row form-group">
                    <label class="col-md-3 control-label text-align-reverse">支付金额</label>
                    <div class="col-md-9">
                        <input type="number" id="payPrice" class="form-control  class-edit" value="" autocomplete="off" />
                    </div>
                </div>

                <div class="row form-group">
                    <label class="col-md-3 control-label text-align-reverse">付款方式</label>
                    <div class="col-md-9">
                        @Html.DropDownList("PayTypes", ViewBag.PayTypes as SelectList, "请选择", new { @class = "form-control" })
                    </div>
                </div>
                <div class="row form-group">
                    <label class="col-md-3 control-label text-align-reverse">汇款方式</label>
                    <div class="col-md-9">
                        @Html.DropDownList("PayMentTypes", ViewBag.PayMentTypes as SelectList, "请选择", new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    关闭
                </button>
                <button type="button" id="SumbitBookkeeping" class="btn btn-default blue">
                    提交
                </button>
            </div>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal -->
<!--添加退货商品-->
<div class="modal fade" id="AddRefundProducts" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <form id="addRefundProductsForm" class="form-horizontal">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria--hidden="true">&times;</button>
                    <h4 class="modal-title">添加商品</h4>
                    <input type="text" name="orderId" value="@Model.Id" hidden />
                </div>
                <div class="modal-body">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <td colspan="4" style="text-align:center"><strong>订单可退货商品</strong></td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <table class="table table-bordered" id="addRefundProductsTable">
                                        <thead>
                                            <tr>
                                                <th style="display:none"></th>
                                                <th>商品名</th>
                                                <th>编码</th>
                                                <th>单价</th>
                                                <th>可退数量</th>
                                                <th>退货数量</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in ViewBag.CanRefundOrderProducts)
                                            {
                                                <tr>
                                                    <td style="display:none"></td>
                                                    <td>@item.ProductName</td>
                                                    <td>@item.ProductCode</td>
                                                    <td>
                                                        <input class="form-control vinput" type="number" name="RefundPrice" value="@item.Price" />
                                                    </td>
                                                    <td>@item.CanRedundQuantity</td>
                                                    <td class="vgroup">
                                                        <input class="form-control vinput" type="number" min="0" max="@item.CanRedundQuantity" name="RefundQuantity" data-saleproductid="@item.SaleProductId" data-id="@item.OrderProductId" data-productname="@item.ProductName" value="0" />
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button id="submitAddRefund" type="button" class="btn btn-primary">添加</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!--修改商品数量和价格-->
<div class="modal fade" id="ChangeProductPrice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form id="productPriceInfoForm" class="form-horizontal">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria--hidden="true">&times;</button>
                    <h4 class="modal-title">数量价格修改</h4>
                    <input type="text" name="OrderProductId" value="" hidden />
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="col-sm-4 control-label vgroup">商品名</label>
                        <div class="col-sm-6"><input class="form-control vinput" type="text" name="productName" value="" disabled /></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label vgroup">商品编码</label>
                        <div class="col-sm-6"><input class="form-control vinput" type="text" name="productCode" value="" disabled /></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label vgroup">商品价格</label>
                        <div class="col-sm-6"><input class="form-control vinput" type="text" name="productOriginalPrice" value="" /></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label vgroup">数量</label>
                        <div class="col-sm-6"><input class="form-control vinput" type="number" name="productQuantity" oninput="changeSumPrice()" value="" /></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label vgroup">销售单价</label>
                        <div class="col-sm-6"><input class="form-control vinput" type="text" name="productSalePrice" oninput="changeSumPrice()" value="" /></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label vgroup">商品总价</label>
                        <div class="col-sm-6"><input class="form-control vinput" type="number" min="0" oninput="changePrice()" name="productSumPrice" value="" /></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button id="UpdateProductPriceInfo" type="button" class="btn red">确定</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!--modal END-->
<!-- loading -->
<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static'>

    <div class="modal-dialog modal-sm">
        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>
        </div>
        <div id="loaderText">
            正在加载请稍后......
        </div>
    </div>
</div>

@section Scripts{
    <script src="~/Metronic/assets/global/plugins/bootstrap-paginator/src/bootstrap-paginator.js"></script>
    <script src="~/Metronic/assets/global/plugins/distpicker/distpicker.js"></script>
    <script type="text/javascript">
        $(function () {
            /*常用变量*/
            var orderId = $("#orderId").val();
            var orginPrice = $("#order_product_orginPrice").val();
            var orderState = $("#orderState").html();


            /*按扭控制*/
            if (orderState == "ToBeConfirmed") {
                $("#unConfirmOrder").attr("disabled", true);
                $("#upLoadOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#Bookkeeping").attr("disabled", true);
                $("#SetInvalid").attr("disabled", false);

            } else if (orderState == "Confirmed") {
                $("#saveB2BOrder").attr("disabled", true);
                $("#addProduct").attr("disabled", true);

                $("#AddRefundProductBtn").attr("disabled", "disabled");

                $('input[name="delSaleProduct"]').attr('disabled', 'disabled');
                $('input[name="updateSaleProduct"]').attr('disabled', 'disabled');

                $("#confirmOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#Bookkeeping").attr("disabled", true);

                $("#SetInvalid").attr("disabled", false);
            } else if (orderState == "Uploaded") {
                $("#saveB2BOrder").attr("disabled", true);
                $("#addProduct").attr("disabled", true);

                $("#AddRefundProductBtn").attr("disabled", "disabled");

                $('input[name="delSaleProduct"]').attr('disabled', 'disabled');
                $('input[name="updateSaleProduct"]').attr('disabled', 'disabled');

                $("#confirmOrder").attr("disabled", true);
                $("#unConfirmOrder").attr("disabled", true);
                $("#upLoadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#Bookkeeping").attr("disabled", true);

                $("#SetInvalid").attr("disabled", "disabled");
            }
            else if (orderState == "returned") {
                $("#upLoadOrder").attr("disabled", true);
                $("#unConfirmOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#SetInvalid").attr("disabled", false);
                $("#Bookkeeping").attr("disabled", true);
            }
            else if (orderState == "StoredWareHouse") {
                $("#saveB2BOrder").attr("disabled", true);
                $("#addProduct").attr("disabled", true);

                $("#AddRefundProductBtn").attr("disabled", "disabled");

                $('input[name="delSaleProduct"]').attr('disabled', 'disabled');
                $('input[name="updateSaleProduct"]').attr('disabled', 'disabled');

                $("#confirmOrder").attr("disabled", true);
                $("#unConfirmOrder").attr("disabled", true);
                $("#upLoadOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", false);
                $("#SetInvalid").attr("disabled", "disabled");
                $("#Bookkeeping").attr("disabled", true);
            }
            else if (orderState == "CheckAccept") {
                $("#saveB2BOrder").attr("disabled", true);
                $("#addProduct").attr("disabled", true);

                $("#AddRefundProductBtn").attr("disabled", "disabled");

                $('input[name="delSaleProduct"]').attr('disabled', 'disabled');
                $('input[name="updateSaleProduct"]').attr('disabled', 'disabled');

                $("#confirmOrder").attr("disabled", true);
                $("#unConfirmOrder").attr("disabled", true);
                $("#upLoadOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#Bookkeeping").attr("disabled", false);
                $("#SetInvalid").attr("disabled", "disabled");
            }
            else if (orderState == "Bookkeeping") {
                $("#saveB2BOrder").attr("disabled", true);
                $("#addProduct").attr("disabled", true);

                $("#AddRefundProductBtn").attr("disabled", "disabled");

                $('input[name="delSaleProduct"]').attr('disabled', 'disabled');
                $('input[name="updateSaleProduct"]').attr('disabled', 'disabled');

                $("#confirmOrder").attr("disabled", true);
                $("#unConfirmOrder").attr("disabled", true);
                $("#upLoadOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#Bookkeeping").attr("disabled", false);
                $("#SetInvalid").attr("disabled", "disabled");
            } else if (orderState == "Invalid") {
                $("#saveB2BOrder").attr("disabled", true);
                $("#addProduct").attr("disabled", true);

                $("#AddRefundProductBtn").attr("disabled", "disabled");

                $('input[name="delSaleProduct"]').attr('disabled', 'disabled');
                $('input[name="updateSaleProduct"]').attr('disabled', 'disabled');

                $("#confirmOrder").attr("disabled", true);
                $("#unConfirmOrder").attr("disabled", true);
                $("#upLoadOrder").attr("disabled", true);
                $("#cancelUploadOrder").attr("disabled", true);
                $("#checkAcceptOrder").attr("disabled", true);
                $("#SetInvalid").attr("disabled", "disabled");
                $("#Bookkeeping").attr("disabled", true);
                $("#updateFinanceMark").attr("disabled", true);
            }

            if (orderState == "ToBeTurned" || orderState == "ToBeConfirmed") {
                $("#CustomerId").attr("disabled", false);
                $("#WareHouseId").attr("disabled", false);
                $("input[name='customerName']").attr("readonly", false);
                $("input[name='customerPhone']").attr("readonly", false);
                $("#Shengshiqu").find("select").each(function () {
                    $(this).attr("disabled", false);
                });
                $("#XXAddress").attr("readonly", false);
                $("#customerMark").attr("disabled", false);
                $("#adminMark").attr("readonly", false);
                $("#toWareHouseMessage").attr("disabled", false);
                $("#SalesMans").attr("disabled", false);
            }
            else {
                $("#CustomerId").attr("disabled", true);
                $("#WareHouseId").attr("disabled", true);
                $("input[name='customerName']").attr("readonly", true);
                $("input[name='customerPhone']").attr("readonly", true);
                $("#Shengshiqu").find("select").each(function () {
                    $(this).attr("disabled", true);
                });
                $("#XXAddress").attr("readonly", true);
                $("#customerMark").attr("disabled", true);
                $("#adminMark").attr("readonly", true);
                $("#toWareHouseMessage").attr("disabled", true);
                $("#SalesMans").attr("disabled", true);
            }



            /*添加商品时价格计算*/
            $("#discount").change(function () {
                var orginPrice = $("#order_product_orginPrice").val();
                var discount = $("#discount").val();
                var price = parseFloat(discount * orginPrice).toFixed(2)
                $("#order_product_price").val(price);
                calcSumPrice();
            });
            $("#order_product_sumprice").focus(function () {
                calcSumPrice();
            })
            $("#order_product_quantity").change(function () {
                calcSumPrice();
            })


            /*表格样式（右对齐）*/
            $('#mainTable tr').each(function () { $(this).children("td:even").attr("class", "text-align-reverse"); });


            /*设置省市区*/
            if ("@Model.AddressDetail"!= null && "@Model.AddressDetail"!= "") {
                var add_split = ($('span[name="FullAddress"]').html()).split(" ");
                $("#Shengshiqu").children('select:first').find("option[value='" + add_split[0] + "']").attr("selected", true);
                $("#Shengshiqu").children('select:eq(1)').append('<option value="' + add_split[1] + '" selected>' + add_split[1] + '</option>');
                $("#Shengshiqu").children('select:last').append('<option value="' + add_split[2] + '" selected>' + add_split[2] + '</option>');
                $("input[name='XXAddress']").val(add_split[3]);
            }



            /*保存订单信息*/
            $("#saveB2BOrder").click(function () {
                var wareHouseId = $("#WareHouseId option:selected").val();
                var adminMark = $("#adminMark").val();
                var customerMark = $("#customerMark").val();
                var toWareHouseMessage = $("#toWareHouseMessage").val();
                var customerId = $("#CustomerId option:selected").val();
                var customerName = $("input[name='customerName']").val();
                var customerPhone = $("input[name='customerPhone']").val();
                var sheng = $("#Shengshiqu").children('select:first').val();
                var shi = $("#Shengshiqu").children('select:eq(1)').val();
                var qu = $("#Shengshiqu").children('select:last').val();
                var salesManId = $("#SalesMans option:selected").val();
                var address = $("#XXAddress").val();
                var addressDetail = sheng + " " + shi + " " + qu + " " + address;
                //if (sheng == null || shi == null || qu == null || sheng == "" || shi == "" || qu == "") {
                //    alertError("地址选择不完全");
                //    return false;
                //}
                //if (customerPhone == null || customerPhone == "") {
                //    alertError("电话不能为空");
                //    return false;
                //}
                //if (customerName == null || customerName == "") {
                //    alertError("联系人不能为空");
                //    return false;
                //}
                //if (address == null || address == "") {
                //    alertError("详细地址不能为空");
                //    return false;
                //}
                if (wareHouseId == null || wareHouseId == "") {
                    alertError("退货仓库不能为空");
                    return false;
                }
                if (customerId == null || customerId == "") {
                    alertError("客户不能为空");
                    return false;
                }
                if (salesManId == null || salesManId == "") {
                    alertError("业务员不能为空");
                    return false;
                }
                var model = {
                    Id: orderId,
                    CustomerId: customerId,
                    CustomerName: customerName,
                    CustomerPhone: customerPhone,
                    AddressDetail: addressDetail,
                    WarehouseId: wareHouseId,
                    CustomerMark: customerMark,
                    AdminMark: adminMark,
                    ToWarehouseMessage: toWareHouseMessage,
                    SalesManId: salesManId
                };

                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/UpdataB2BRefundOrder",
                        type: "POST",
                        data: { orderModel: model },
                        success: function (data) {
                            if (data.isSucc) {
                                alertSuccess("保存成功！");
                                setTimeout(function () { window.location.reload() }, 800);
                            } else {
                                alertError(data.msg);
                            }
                        }
                    })
                }, null, "点击确定保存信息！")
            });


            /*删除订单商品*/
            $("#OrderProductsTB a").click(function () {
                if (orderState == "Confirmed" || orderState == "Uploaded" || orderState == "Invalid") {
                    alertError("此订单状态无法删除！")
                    return false;
                }
                var saleProductId = $(this).children("span").html();
                var productName = $(this).parent("td").parent("tr").find("#dProductName").html();
                var quantity = $(this).parent("td").parent("tr").find("#dProductQuantity").html();
                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/DeleteOrderProductById",
                        type: "post",
                        data: { id: saleProductId, orderId: orderId, productName: productName, quantity: quantity },
                        success: function (data) {
                            if (data.isSucc) {
                                alertSuccess("删除成功！");
                                setTimeout(function () { window.location.reload() }, 800);

                            } else {
                                alertError(data.msg);
                            }
                        }
                    })
                }, null, "点击确定删除商品？")
            })


            /*确认订单*/
            $("#confirmOrder").click(function () {
                var updateType = "Confirm";
                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/SetB2BRefundOrderConfirm",
                        data: { orderId: orderId, updateType: updateType },
                        success: function (data) {
                            if (data.isSucc) {
                                alertSuccess("确认成功！")
                                setTimeout(function () { window.location.reload() }, 800);

                            }
                        }
                    })
                }, null, "是否确认订单？")
            })


            /*反确认订单*/
            $("#unConfirmOrder").click(function () {
                var updateType = "UnConfirm";
                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/SetB2BRefundOrderConfirm",
                        data: { orderId: orderId, updateType: updateType },
                        success: function (data) {
                            if (data.isSucc) {
                                alertSuccess("反确认成功！")
                                setTimeout(function () { window.location.reload() }, 800);
                            }
                        }
                    })
                }, null, "是否反确认订单？")

            })


            /*上传订单*/
            $("#upLoadOrder").click(function () {

                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/UploadB2BRefundOrder",
                        data: { id: orderId },
                        type: "POST",
                        beforeSend: function () {
                            //防止重复提交
                            $("#upLoadOrder").attr("disabled", true).css("pointer-events", "none");
                            $('#upLoadOrder').css({ opacity: 0.2 });
                            $('#loading').modal('show');
                        },
                        success: function (res) {
                            var data = JSON.parse(res);//返回的json为字符串格式
                            $('#loading').modal('hide');
                            if (data.isSucc) {
                                alertSuccess("上传成功！");
                                setTimeout(function () { window.location.reload() }, 800);

                            } else {
                                alertError(data.msg);

                            }
                        },
                        error: function (res) {
                            $('#loading').modal('hide');
                            alertError("上传失败！");
                            $("#upLoadOrder").attr("disabled", false).css("pointer-events", "auto");
                            $('#upLoadOrder').css({ opacity: 1 });

                        }
                    })
                }, null, "确定上传？");
            })


            /*取消上传订单*/
            $("#cancelUploadOrder").click(function () {
                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/UnUploadB2BOrder",
                        data: { id: orderId },
                        type: "POST",
                        beforeSend: function () {
                            //防止重复提交
                            $("#cancelUploadOrder").attr("disabled", true).css("pointer-events", "none");
                            $('#cancelUploadOrder').css({ opacity: 0.2 });
                            $('#loading').modal('show');
                        },
                        success: function (res) {
                            try {
                                var data = JSON.parse(res);//返回的json为字符串格式
                                $('#loading').modal('hide');
                                if (data.isSucc) {
                                    alertSuccess("取消成功！");
                                    setTimeout(function () { window.location.reload() }, 800);

                                } else {
                                    alertError(data.msg);

                                }
                            } catch (e) {
                                alertError(res.msg);
                            }
                        },
                        error: function (res) {
                            $('#loading').modal('hide');
                            alertError("取消出错！");
                            $("#cancelUploadOrder").attr("disabled", false).css("pointer-events", "auto");
                            $('#cancelUploadOrder').css({ opacity: 1 });

                        }
                    })
                }, null, "确定取消？");
            })

            /*验收B2B退单*/
            $("#checkAcceptOrder").click(function () {
                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/CheckAcceptB2BRefundOrder",
                        type: "POST",
                        data: { orderId: orderId },
                        success: function (res) {
                            if (res.isSucc) {
                                alertSuccess("验收成功");
                                setTimeout(function () { window.location.reload(); }, 800);
                            }
                            else {
                                alertError(res.msg)
                            }
                        }
                    })
                }, null, "确定验收？");
            })

            /*记账B2B退单*/
            $("#Bookkeeping").click(function () {
                $("#BookkeepingModal").modal();
            })

            $("#SumbitBookkeeping").click(function () {
                var isPay = $('#radio1').is(':checked');
                var payPrice = parseInt($("#payPrice").val());
                if (!payPrice > 0) {
                    alertWarn("支付金额必须大于0");
                    return false;
                }

                var totalPrice =@Model.SumPrice;
                var payedPrice =@Model.PayPrice;
                if (payPrice + payedPrice > totalPrice) {
                    alertWarn("支付金额加上已退金额大于总金额，请检查！");
                    return false;
                }

                var payType = $("#PayTypes option:selected").val();
                if (payType == null || payType == "") {
                    alertWarn("请选择付款方式");
                    return false;
                }
                var payMentType = $("#PayMentTypes option:selected").val();
                if (payMentType == null || payMentType == "") {
                    alertWarn("请选择汇款方式");
                    return false;
                }

                var OrderModel = {
                    Id: orderId,
                    PayType: payType,
                    PayMentType: payMentType,
                    PayPrice: payPrice,
                    IsPayOrRefund: isPay
                }

                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/BookKeeping",
                        type: "POST",
                        data: { OrderModel: OrderModel },
                        success: function (data) {
                            if (data.isSucc) {
                                alertSuccess("操作成功");
                                setTimeout(function () { window.location.reload(); }, 800);
                            }
                            else {
                                alertError(data.msg);
                            }
                        }

                    });
                }, null, "确定记账？");
            });

            //退单设为无效
            $("#SetInvalid").click(function () {
                isContinue(function () {
                    $.ajax({
                        url: "/B2COrder/SetRefundOrderInvalid",
                        type: "post",
                        data: { "id":@Model.Id},
                        success: function (res) {
                            if (res.isSucc) {
                                alertSuccess("修改成功！");
                                setTimeout(function () { window.location.reload(); }, 800);
                            }
                            else {
                                alertError(res.msg);
                            }
                        }
                    })
                }, null, "退单设为无效，并且原订单恢复原订单的发货数量，若原订单为无效状态则恢复为已发货状态，确定设为无效退单吗？")
            });
            /*修改财务备注*/
            $("#updateFinanceMark").click(function () {
                isContinue(function () {
                    $.ajax({
                        url: "/B2BOrder/UpdateFinanceMark",
                        type: "POST",
                        data: { orderId: orderId, mark: $("#financeMark").val() },
                        success: function (res) {
                            if (res.isSucc) {
                                alertSuccess("修改成功");
                                setTimeout(function () { window.location.reload(); }, 800);
                            }
                            else {
                                alertError(res.msg)
                            }
                        }
                    })
                }, null, "确定修改财务备注？");
            })
        });


        /*操作日志*/
        var showOpLog = function (orderId) {
            $.ajax({
                url: "/B2BOrder/GetOrderLog?orderId=" + orderId,
                success: function (data) {
                    var html = "";
                    for (var i = 0; i < data.data.log.length; i++) {
                        html += "<tr>" +
                            "<td>" + data.data.log[i].createdBy + "[" + data.data.dUser[data.data.log[i].createdBy] + "]</td>" +
                            "<td>" + data.data.log[i].optionType + "</td>" +
                            "<td>" + data.data.log[i].createdTime + "</td>" +
                            "<td>" + data.data.orderStateStr[data.data.log[i].orderState] + "</td>" +
                            "<td>" + data.data.log[i].mark + "</td>" +
                            "</tr>"
                    }
                    $("#orderOpLog tbody").html(html);
                }
            })
            $("#orderOpLog").modal();
        }


        /*销售商品*/
        var showProducts = function (searchKey) {
            var priceTypeId = $("#PriceTypeId option:selected").val();
            var searchKey = $("#searchKey").val()
            $oms.paginator({
                pageLimitId: "pageLimit",
                url: "/Product/GetProducts",
                data: { search: searchKey, pageSize: 10, priceType: priceTypeId },
                success: function (data) {
                    var html = "";
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; i++) {
                            html += "<tr>" +
                                "<td>" + data[i].code + "</td >" +
                                "<td>" + data[i].name + "</td>" +
                                "<td>" + (data[i].nameEn == null ? "" : data[i].nameEn) + "</td>" +
                                "<td>" +
                                "<a class=\"delete\" href=\"javascript:;\" onclick=\"getProductInfo(" + data[i].saleProductId + ")\"> 添加 </a>" +
                                "</td>" +
                                "</tr >";
                        }
                    }
                    $("#tbody").html(html);
                }
            });
            $("#productsModal").modal();
        }
        var getProductInfo = function (saleProductId) {
            var priceTypeId = $("#PriceTypeId option:selected").val();
            $.ajax({
                url: "/Product/GetProductInfo",
                type: "post",
                data: { saleProductId: saleProductId, priceTypeId: priceTypeId },
                success: function (data) {
                    if (data.isSucc) {
                        if (data.data) {
                            $("#pName").text(data.data.saleProduct.product.name);
                            $("#code").text(data.data.saleProduct.product.code);
                        }
                        if (data != null) {
                            $("#availableStock").text(data.data.saleProduct.availableStock);
                            $("#stock").text(data.data.saleProduct.stock)
                            $("#lockStock").text(data.data.saleProduct.lockStock)
                            $("#order_product_id").val(data.data.saleProductId)
                            if (data.data.price) {
                                $("#order_product_orginPrice").val(data.data.price);

                                f = Math.round(parseFloat(parseFloat($("#order_product_orginPrice").val()) * 1.00) * 100) / 100;
                                $("#order_product_price").val(f);
                            }
                            else {
                                alertWarn("该商品未更新价格类型下价格信息");
                            }
                        }
                        else {
                            alertWarn("该商品未更新库存信息");
                        }

                    }
                },
                error: function (result) {
                    alertInfo("Can't get the ProductInfo!" + result);
                }
            })
            $("#stack2").modal();
        }


        /*商品价格*/
        var calcSumPrice = function () {
            var discount = $("#discount").val();
            var orginPrice = $("#order_product_orginPrice").val();
            var quantity = $("#order_product_quantity").val();
            var sumPrice = parseFloat(discount * quantity * orginPrice).toFixed(2);
            $("#order_product_sumprice").val(sumPrice);
        }


        /*添加商品*/
        var addOrderProduct = function () {
            var orderId = $("#orderId").val();
            var saleProductId = $("#order_product_id").val();
            var productName = $("#pName").html();
            var discount = $("#discount").val();
            var orginPrice = $("#order_product_orginPrice").val();
            var quantity = $("#order_product_quantity").val();
            var price = parseFloat($("#discount").val() * $("#order_product_orginPrice").val()).toFixed(2);
            var sumPrice = parseFloat(discount * quantity * orginPrice).toFixed(2);
            var data = { OrderId: orderId, SaleProductId: saleProductId, Quantity: quantity, OrginPrice: orginPrice, Price: price, SumPrice: sumPrice, ProductName: productName }
            $.ajax({
                url: "/B2BOrder/AddB2BRefundOrderProduct",
                data: data,
                type: "post",
                success: function (data) {
                    if (data.isSucc) {
                        alertSuccess("添加成功！")
                        setTimeout(function () { window.location.reload() }, 800)

                    } else {
                        alertError(data.msg);
                    }
                }
            })
        };

        //退货商品添加
        //填写退货价格
        $("#addRefundProductsTable tr td input[name='RefundPrice']").blur(function () {
            var inputVal = parseInt($(this).val());
            if (inputVal < 0) { alertError("请输入正确的价格！"); }
        });
        //填写退货数量进行判断
        $("#addRefundProductsTable tr td input[name='RefundQuantity']").blur(function () {
            var inputVal = parseInt($(this).val());
            var maxInputVal = parseInt($(this).attr("max"));
            if (inputVal < 0) { alertError("请输入正确的数量！"); }
            if (inputVal > maxInputVal) {
                alertError("填写的数据大于可退货的数量，请重新填写！");
            }
        });

        //添加商品
        $("#submitAddRefund").click(function () {
            var refundProductInfo = [];
            var isNotInputQuantity = true;
            var isMoreQuantity = false;
            $('#addRefundProductsTable tr td input[name="RefundQuantity"]').each(function () {
                if (parseInt($(this).val()) > 0) {
                    refundProductInfo.push({
                        'saleProductId': parseInt($(this).data('saleproductid')),
                        'refundQuantity': parseInt($(this).val()),
                        'refundOrderProductId': parseInt($(this).data('id')),
                        'productname': $(this).data('productname'),
                        'price': $(this).parents("tr").find("input[name='RefundPrice']").val(),
                    });
                }
                if (parseInt($(this).val()) > 0) {
                    isNotInputQuantity = false;
                }
                if (parseInt($(this).val()) > parseInt($(this).attr("max"))) {
                    isMoreQuantity = true;
                }
            });
            //判断拆分时是否填写拆分数量
            if (isNotInputQuantity) {
                alertError("请填写退货数量！");
                return false;
            }
            //判断填写数量是否超过可退货数量
            if (isMoreQuantity) {
                alertError("填写的数据大于可退货的数量，请重新填写！");
                return false;
            }
            isContinue(function () {
                $.ajax({
                        type: 'post',
                        url: '/B2COrder/AddRefundProducts',//流程一样可以与B2C共用
                        data: { 'orderId':@Model.Id , 'refundProductInfo': JSON.stringify(refundProductInfo) },
                        success: function (data) {
                        if (data.isSucc) {
                            alertSuccess("添加成功！");
                            setTimeout(function () { window.location.reload() }, 800);
                        } else {
                            alertError(data.msg);

                        }
                    },
                    error: function (e) {
                        alertError("添加失败！" + e);
                        setTimeout(function () { window.location.reload() }, 800)
                    }
                });
                }, null, "确定添加商品？")
        });


            /*修改商品B2B和B2C流程一致可以共用*/
            $("input[name='updateSaleProduct']").click(function () {
                var id = $(this).data("id");
                var name = $(this).parent().siblings("[name='tProductName']").text();
                var code = $(this).parent().siblings("[name='tProductCode']").text();
                var quantity = $(this).parent().siblings("[name='tQuantity']").attr("data-quantity");
                var originPrice = $(this).parent().siblings("[name='tOrginPrice']").text();
                var salePrice = $(this).parent().siblings("[name='tPrice']").text();
                var sumPrice = $(this).parent().siblings("[name='tSumPrice']").text();

                var modelObj = $('#ChangeProductPrice');
                modelObj.find("input[name='OrderProductId']").val(id);
                modelObj.find("input[name='productName']").val(name);
                modelObj.find("input[name='productCode']").val(code);
                modelObj.find("input[name='productQuantity']").val(quantity);
                modelObj.find("input[name='productOriginalPrice']").val(originPrice);
                modelObj.find("input[name='productSalePrice']").val(salePrice);
                modelObj.find("input[name='productSumPrice']").val(sumPrice);
            });
            //修改商品
            $('#UpdateProductPriceInfo').click(function () {
                var modelObj = $('#ChangeProductPrice');   
                var productName = modelObj.find("input[name='productName']").val();
                var id = modelObj.find("input[name='OrderProductId']").val();
                var quantity = modelObj.find("input[name='productQuantity']").val();
                var originPrice = modelObj.find("input[name='productOriginalPrice']").val();
                var salePrice = modelObj.find("input[name='productSalePrice']").val();
                var sumPrice = modelObj.find("input[name='productSumPrice']").val();
                if (quantity == null || quantity == '') {
                    alertError('数量不能为空');
                    return;
                }
                if (originPrice == null || originPrice == '') {
                    alertError('商品价格不能为空');
                    return;
                }
                if (salePrice == null || salePrice == '') {
                    alertError('销售价格不能为空');
                    return;
                }
                $.ajax({
                    url: '/B2COrder/UpdateRefundOrderProduct',
                    type: 'POST',
                    data: { id: id, quantity: quantity, originPrice: originPrice, salePrice: salePrice, sumPrice: sumPrice, productName: productName },
                    success: function (res) {
                        if (res.isSucc) {
                            alertSuccess("修改成功！");
                            window.location.reload();
                        }
                        else {
                            alertError(res.msg);
                        }
                    }
                })
            });

            //删除销售商品 B2B和B2C流程一致可以共用
            $("input[name='delSaleProduct']").click(function () {
                var orderState = $("#OrderStateStr").html();
                if (orderState == "无效" || orderState=="已确认") {
                    alertError("此订单状态下，无法删除！");
                    return false;
                }
                var url = '/B2COrder/DelRefundOrderProduct?id=' + $(this).data("id") + '&&orderId=' +@Model.Id+'&&name=' + $('td[name="tProductName"]').html();
                isContinue(function () {
                    $.ajax({
                        url: url,
                        success: function (result) {
                            if (result.isSucc) {
                                alertSuccess("删除成功！");
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1500);
                            } else {
                                alertError(result.msg);
                            }

                        }
                    })
                }, null, "是否删除")
            });
        /*修改商品输入总价自动计算价格*/
        var changePrice = function () {
            var sumPrice = $("#ChangeProductPrice input[name='productSumPrice']").val();
            var qty = $("#ChangeProductPrice input[name='productQuantity']").val();
            var salePrice = $("#ChangeProductPrice input[name='productSalePrice']").val();
            if (qty != 0) {
                var data = Math.floor((sumPrice / qty) * 100) / 100;
                $("#ChangeProductPrice input[name='productSalePrice']").val(data);
            }
        }
        //修改商品数量和销售单价时计算总价
        var changeSumPrice = function () {
            var qty = $("#ChangeProductPrice input[name='productQuantity']").val();
            var salePrice = $("#ChangeProductPrice input[name='productSalePrice']").val();
            if (qty != 0) {
                $("#ChangeProductPrice input[name='productSumPrice']").val(qty * salePrice)
            }
        }

    </script>
}